define(["jquery","core/ajax","core/notification","core/pubsub"],function(t,e,i,n){return{setup:function(n){var o=0,a=!1,c=null;t(".submitbtns").prepend('<div class="text-right"><video id="video">Video stream not available.</video><canvas id="canvas" style="display:none;"></canvas> <div class="output" style="display:none;"><img id="photo" alt="The screen capture will appear in this box."/></div> </div>');var r=document.getElementById("video"),d=document.getElementById("canvas"),s=document.getElementById("photo"),u=function(){var t=d.getContext("2d");if(o){d.width=320,d.height=o,t.drawImage(r,0,0,320,o),c=d.toDataURL("image/png"),s.setAttribute("src",c),n.webcampicture=c;var a={methodname:"quizaccess_proctoring_send_camshot",args:{screenshotid:n.id,quizid:n.quizid,webcampicture:c}};e.call([a])[0].done(function(t){t.warnings.length<1?console.log(t):i.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(i.exception)}else!function(){var t=d.getContext("2d");t.fillStyle="#AAA",t.fillRect(0,0,d.width,d.height),c=d.toDataURL("image/png"),s.setAttribute("src",c)}()};navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){r.srcObject=t,r.play()}).catch(function(t){console.log("An error occurred: "+t)}),r.addEventListener("canplay",function(t){a||(o=r.videoHeight/(r.videoWidth/320),isNaN(o)&&(o=240),r.setAttribute("width",320),r.setAttribute("height",o),d.setAttribute("width",320),d.setAttribute("height",o),a=!0)},!1),r.addEventListener("click",function(t){u(),t.preventDefault()},!1)},init:function(t){var n=320,o=0,a=!1,c=null,r=null,d=null,s=null;function u(){var t=r.getContext("2d");t.fillStyle="#AAA",t.fillRect(0,0,r.width,r.height),s=r.toDataURL("image/png"),d.setAttribute("src",s)}return c=document.getElementById("video"),r=document.getElementById("canvas"),d=document.getElementById("photo"),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){c.srcObject=t,c.play()}).catch(function(t){console.log("An error occurred: "+t)}),c.addEventListener("canplay",function(t){a||(o=c.videoHeight/(c.videoWidth/n),isNaN(o)&&(o=n/(4/3)),c.setAttribute("width",n),c.setAttribute("height",o),r.setAttribute("width",n),r.setAttribute("height",o),a=!0)},!1),c.addEventListener("click",function(a){!function(){var a=r.getContext("2d");if(n&&o){r.width=n,r.height=o,a.drawImage(c,0,0,n,o),s=r.toDataURL("image/png"),d.setAttribute("src",s),console.log(d);var l={screenshotid:t.id,quizid:t.quizid,webcampicture:s},g={methodname:"quizaccess_proctoring_send_camshot",args:l};e.call([g])[0].done(function(t){t.warnings.length<1?console.log(t):i.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(i.exception)}else u()}(),a.preventDefault()},!1),u(),s}}});