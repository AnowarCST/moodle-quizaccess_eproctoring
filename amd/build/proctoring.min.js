var isCameraAllowed=!1;define ("quizaccess_proctoring/proctoring",["jquery","core/ajax","core/notification","core/pubsub"],function(a,b,c){var d=0;return{setup:function setup(e){if(null!=document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length){return!1}if(null!=document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length){return!1}var f=0,g=!1,h=null;a("#mod_quiz_navblock").append("<div class=\"card-body p-3\"><h3 class=\"no text-left\">Webcam</h3> <br/><video id=\"video\">Video stream not available.</video><canvas id=\"canvas\" style=\"display:none;\"></canvas> <div class=\"output\" style=\"display:none;\"><img id=\"photo\" alt=\"The screen capture will appear in this box.\"/></div> </div>");var i=document.getElementById("video"),j=document.getElementById("canvas"),k=document.getElementById("photo"),l=function(){var a=j.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,j.width,j.height);h=j.toDataURL("image/png");k.setAttribute("src",h)},m=function(){var a=j.getContext("2d");if(f){j.width=230;j.height=f;a.drawImage(i,0,0,230,f);h=j.toDataURL("image/png");k.setAttribute("src",h);e.webcampicture=h;var g={courseid:e.courseid,screenshotid:e.id,quizid:e.quizid,webcampicture:h};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:g}])[0].done(function(a){if(1>a.warnings.length){d++}else{c.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}}).fail(c.exception)}else{l()}};navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){i.srcObject=a;i.play();isCameraAllowed=!0}).catch(function(a){console.log("An error occurred: "+a);hideButtons()});if(i){i.addEventListener("canplay",function(){if(!g){f=i.videoHeight/(i.videoWidth/230);if(isNaN(f)){f=230/(4/3)}i.setAttribute("width",230);i.setAttribute("height",f);j.setAttribute("width",230);j.setAttribute("height",f);g=!0}},!1)}else{hideButtons()}i.addEventListener("click",function(a){m();a.preventDefault()},!1);setTimeout(m,3e3);setInterval(m,3e4)},init:function init(d){var i=0,j=!1,k=null,l=null,m=null,n=null;function e(){k=document.getElementById("video");l=document.getElementById("canvas");m=document.getElementById("photo");navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){k.srcObject=a;k.play();isCameraAllowed=!0}).catch(function(a){console.log("An error occurred: "+a);h()});if(k){k.addEventListener("canplay",function(){if(!j){i=k.videoHeight/(k.videoWidth/320);if(isNaN(i)){i=240}k.setAttribute("width",320);k.setAttribute("height",i);l.setAttribute("width",320);l.setAttribute("height",i);j=!0}},!1)}else{h()}k.addEventListener("click",function(a){g();a.preventDefault()},!1);f()}function f(){if(isCameraAllowed){var a=l.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,l.width,l.height);n=l.toDataURL("image/png");m.setAttribute("src",n)}else{h()}}function g(){var a=l.getContext("2d");if(i){l.width=320;l.height=i;a.drawImage(k,0,0,320,i);n=l.toDataURL("image/png");m.setAttribute("src",n);var e={courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:n};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:e}])[0].done(function(a){if(!(1>a.warnings.length)){c.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}}).fail(c.exception)}else{f()}}function h(){a(".mod_quiz-next-nav").prop("disabled",!0);a(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}e();return n}}});$(function(){$("#id_submitbutton").prop("disabled",!0);$("#id_proctoring").on("change",function(){if(this.checked&&isCameraAllowed){$("#id_submitbutton").prop("disabled",!1)}else{$("#id_submitbutton").prop("disabled",!0)}})});function hideButtons(){$(".mod_quiz-next-nav").prop("disabled",!0);$(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}
//# sourceMappingURL=proctoring.min.js.map
